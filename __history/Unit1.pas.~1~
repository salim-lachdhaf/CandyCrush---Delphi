unit Unit1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Menus,unit2,unit3, ExtCtrls, Grids, jpeg, StdCtrls, Buttons, shellapi,
  MPlayer;

type
  TForm1 = class(TForm)
    mainmenu: TMainMenu;
    menu: TMenuItem;
    Option1: TMenuItem;
    Nouvellepartie1: TMenuItem;
    N2: TMenuItem;
    Quitter1: TMenuItem;
    graphique: TMenuItem;
    sound: TMenuItem;
    Active1: TMenuItem;
    Desactiver1: TMenuItem;
    PleinEcran1: TMenuItem;
    Reduite1: TMenuItem;
    Difficult1: TMenuItem;
    Facile1: TMenuItem;
    Moyenne1: TMenuItem;
    Difficil1: TMenuItem;
    Aide1: TMenuItem;
    Commentjouer1: TMenuItem;
    AproposdeDevlopper1: TMenuItem;
    rouge: TSpeedButton;
    halwaselected: TSpeedButton;
    jaune: TSpeedButton;
    jjauneselcted: TSpeedButton;
    mauve: TSpeedButton;
    mauveselected: TSpeedButton;
    bleu: TSpeedButton;
    vertselected: TSpeedButton;
    bleuselected: TSpeedButton;
    vert: TSpeedButton;
    halwa: TSpeedButton;
    rougeselected: TSpeedButton;
    vide: TSpeedButton;
    vide1: TSpeedButton;
    Image1: TImage;
    Actualiser1: TMenuItem;
    Timer1: TTimer;
    close: TImage;
    sonactiver: TImage;
    sondesactiver: TImage;
    Panel1: TPanel;
    Label1: TLabel;
    niveaulabel: TLabel;
    Panel2: TPanel;
    Label2: TLabel;
    Label3: TLabel;
    Panel3: TPanel;
    Label4: TLabel;
    Label5: TLabel;
    Timer2: TTimer;
    Label6: TLabel;
    gagne: TImage;
    GAME: TStringGrid;
    lose: TImage;
    MediaPlayer1: TMediaPlayer;
    MediaPlayer2: TMediaPlayer;
    MediaPlayer3: TMediaPlayer;
    gamesound: TTimer;
    gamend: TTimer;
    MediaPlayer4: TMediaPlayer;
    procedure Quitter1Click(Sender: TObject);
    procedure Reduite1Click(Sender: TObject);
    procedure Active1Click(Sender: TObject);
    procedure Desactiver1Click(Sender: TObject);
    procedure Facile1Click(Sender: TObject);
    procedure Moyenne1Click(Sender: TObject);
    procedure Difficil1Click(Sender: TObject);
    procedure PleinEcran1Click(Sender: TObject);
    procedure AproposdeDevlopper1Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Nouvellepartie1Click(Sender: TObject);
    procedure FormResize(Sender: TObject);
    procedure GAMEMouseDown(Sender: TObject; Button: TMouseButton;
      Shift: TShiftState; X, Y: Integer);
    procedure Actualiser1Click(Sender: TObject);
    procedure Timer1Timer(Sender: TObject);
    procedure closeClick(Sender: TObject);
    procedure sonactiverClick(Sender: TObject);
     procedure sondesactiverClick(Sender: TObject);
    procedure Timer2Timer(Sender: TObject);
    procedure Commentjouer1Click(Sender: TObject);
    procedure gamesoundTimer(Sender: TObject);
    procedure gamendTimer(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;
 piece:array[1..12]of string=('rouge','jaune','bleu','vert','halwa','mauve','bleuselected','vertselected','halwaselected','mauveselected','jauneselected','rougeselected') ;
 Niveau:byte;
 x,y,xv,yv:array[1..10]of integer;
 nb,nbsel,nb2,nbv,selx,sely,scor:integer;
 inter:Longint;
 a:boolean;
 ss,mm,hh,dep,depmax:word;

 implementation



{$R *.dfm}
{$R test.RES}
 function exist(rechx,rechy:integer):boolean;
 var w:integer;
 begin
 w:=1;
  while(w<=nb2)and((rechx<>x[w])or(rechy<>y[w]))do
  inc(w);

  if w>nb2 then
  result:=false
  else result:=true;

 end;

procedure coloration();
var i,j:integer;
begin
for i:=1 to 9  do
begin
 for j:=1 to 9 do
 begin

  if form1.GAME.Cells[i-1,j-1]='rouge' then
    FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.rouge.Glyph)
    else if  form1.GAME.Cells[i-1,j-1]='rougeselected' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.rougeselected.Glyph)
      else if  form1.GAME.Cells[i-1,j-1]='vert' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.vert.Glyph)
       else if  form1.GAME.Cells[i-1,j-1]='vertselected' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.vertselected.Glyph)
       else if  form1.GAME.Cells[i-1,j-1]='bleu' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.bleu.Glyph)
       else if  form1.GAME.Cells[i-1,j-1]='bleuselected' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.bleuselected.Glyph)
         else if  form1.GAME.Cells[i-1,j-1]='halwa' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.halwa.Glyph)
        else if  form1.GAME.Cells[i-1,j-1]='halwaselected' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.halwaselected.Glyph)
       else if  form1.GAME.Cells[i-1,j-1]='mauve' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.mauve.Glyph)
       else if  form1.GAME.Cells[i-1,j-1]='mauveselected' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.mauveselected.Glyph)
       else if  form1.GAME.Cells[i-1,j-1]='jaune' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.jaune.Glyph)
         else if  form1.GAME.Cells[i-1,j-1]='jauneselected' then
     FORM1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.jjauneselcted.Glyph)
       else if form1.GAME.Cells[i-1,j-1]='vide' then
      form1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.vide.Glyph)
        else if form1.GAME.Cells[i-1,j-1]='vide1' then
      form1.GAME.Canvas.Draw((J*72)-72+J-1,(I*63)-63+I-1,form1.vide1.Glyph) ;




    


 end;
 end;
 form1.GAME.Repaint;

 end;//end coloration//
 function existvide():boolean;
var c,v:integer;
begin
result :=false;
for c:=0 to 8 do
 for v :=0 to 8 do
   if form1.GAME.Cells[c,v]='vide' then
   result:=(true);


end;


  procedure recherche() ;
 var i,j,t,h:integer;

 begin
 form1.game.Enabled:=false;
form1.Timer1.Enabled:=false;

    nb:=0;
     nb2:=0;
     nbv:=0;

   try
        for i:=0 to 8 do
          begin
          t:=0;
            for j:=t to 6 do
             begin
             t:=j+1;
             nb:=1;
                 while(form1.GAME.Cells[i,j]=form1.GAME.Cells[i,t]) and (t<=8)and(form1.GAME.Cells[i,j]<>'vide') do
                 begin inc(t); inc(nb); end;


               if nb>=3  then
               begin
                for h:=1 to nb do
                  begin
                  if (exist(j+h-1,i)=false) then
                  begin
                   inc(nb2);
                   x[nb2]:=j+h-1;
                    y[nb2]:=i;
                    end;

                  end;

              end;

              end;
              end;


       except end;

            
       try
        for i:=0 to 8 do
          begin
          t:=0;
            for j:=t to 6 do
             begin
             t:=j+1;
             nb:=1;
                 while(form1.GAME.Cells[j,i]=form1.GAME.Cells[t,i]) and (t<=8)and(form1.GAME.Cells[j,i]<>'vide') do
                 begin inc(t); inc(nb); end;


               if nb>=3  then
               begin
                for h:=1 to nb do
                  begin
                  if (exist(i,j+h-1)=false) then
                  begin
                  inc(nbv);
                   inc(nb2);
                   y[nb2]:=j+h-1;
                    x[nb2]:=i;
                    end;

                  end;

              end;

              end;
              end;


       except end;



     if nb2>=3 then
     begin
      for i:=1 to nb2 do
      form1.GAME.Cells[y[i],x[i]]:='vide';
     if (form1.Active1.Checked=true) then
     begin
     form1.MediaPlayer4.Close;
     form1.MediaPlayer4.Open;
     form1.MediaPlayer4.Play;
     end;

     coloration();
     coloration();
      form1.Timer1.Interval:=400;
      form1.Timer1.Enabled:=true;

      end else form1.game.Enabled:=true;
   
 end;


 procedure niveau3();
 var alea,i,j:byte;
 verif1,verif2,verif3,verif4:boolean;
 begin

    for i :=0 to 8 do
     begin
      for j:=0 to 8 do
      begin

          randomize;
           verif1:=true;verif2:=true;verif3:=true;verif4:=true;
        repeat
         alea:=random(6)+1;
         try
         if (form1.GAME.Cells[i-2,j]<>piece[alea])then
           begin
           verif1:=true;
           end
          else  verif1:=false ;
           except end;
            try
         if (form1.GAME.Cells[i+2,j]<> piece[alea])then
           begin
           verif2:=true;
           end
           else  verif2:=false ;
           except end;
            try
         if (form1.GAME.Cells[i,j-2]<>piece[alea])then
           begin
           verif3:=true;
           end
           else  verif3:=false ;
           except end;
            try
         if (form1.GAME.Cells[i,j+2]<> piece[alea])then
           begin
           verif4:=true;
           end
           else  verif4:=false;
           except end;
      until ((verif1=true)and(verif2=true)and(verif3=true)and(verif4=true));

       Form1.GAME.Cells[i,j]:=piece[alea];

      end;
     end;
        for i:=0 to 1 do
          Form1.GAME.Cells[i,4]:='vide1';
          for i:=8 downto 7 do
          Form1.GAME.Cells[i,4]:='vide1';
          for i:=0 to 1 do
          Form1.GAME.Cells[4,i]:='vide1';
          for i:=8 downto 7 do
          Form1.GAME.Cells[4,i]:='vide1';

     end;   //end level

 procedure niveau2();
 var alea,i,j:byte;
 verif1,verif2,verif3,verif4:boolean;
 begin

    for i :=0 to 8 do
     begin
      for j:=0 to 8 do
      begin

          randomize;
           verif1:=true;verif2:=true;verif3:=true;verif4:=true;
        repeat
         alea:=random(4)+1;
         try
         if (form1.GAME.Cells[i-2,j]<>piece[alea])then
           begin
           verif1:=true;
           end
          else  verif1:=false ;
           except end;
            try
         if (form1.GAME.Cells[i+2,j]<> piece[alea])then
           begin
           verif2:=true;
           end
           else  verif2:=false ;
           except end;
            try
         if (form1.GAME.Cells[i,j-2]<>piece[alea])then
           begin
           verif3:=true;
           end
           else  verif3:=false ;
           except end;
            try
         if (form1.GAME.Cells[i,j+2]<> piece[alea])then
           begin
           verif4:=true;
           end
           else  verif4:=false;
           except end;
      until ((verif1=true)and(verif2=true)and(verif3=true)and(verif4=true));

       Form1.GAME.Cells[i,j]:=piece[alea];

      end;
     end;

     Form1.GAME.Cells[8,8]:='vide1';
     Form1.GAME.Cells[0,0]:='vide1';
     Form1.GAME.Cells[0,8]:='vide1';
     Form1.GAME.Cells[8,0]:='vide1';
     Form1.GAME.Cells[4,4]:='vide1';

     end;   //end level2

 procedure niveau1();
 var alea,i,j:byte;
 verif1,verif2,verif3,verif4:boolean;
 begin
       

    for i :=0 to 8 do
     begin
      for j:=0 to 8 do
      begin

          randomize;
           verif1:=true;verif2:=true;verif3:=true;verif4:=true;
        repeat
         alea:=random(3)+1;
         try
         if (form1.GAME.Cells[i-2,j]<>piece[alea])then
           begin
           verif1:=true;
           end
          else  verif1:=false ;
           except end;
            try
         if (form1.GAME.Cells[i+2,j]<> piece[alea])then
           begin
           verif2:=true;
           end
           else  verif2:=false ;
           except end;
            try


         if (form1.GAME.Cells[i,j-2]<>piece[alea])then
           begin
           verif3:=true;
           end
           else  verif3:=false ;
           except end;
            try
         if (form1.GAME.Cells[i,j+2]<> piece[alea])then
           begin
           verif4:=true;
           end
           else  verif4:=false;
           except end;
      until ((verif1=true)and(verif2=true)and(verif3=true)and(verif4=true));

       Form1.GAME.Cells[i,j]:=piece[alea];

      end;
     end;

     end;   //end level

 procedure initialisation();
   var i,j:word;
 begin
 ss:=0;
 mm:=niveau-1;
 hh:=0;
 dep:=0;

 Form1.niveaulabel.Caption:=inttostr(strtoint(Form1.niveaulabel.Caption)+1);

 form1.label5.Caption:='0/'+inttostr(depmax);
         form1.timer2.Enabled:=true;
 nb:=0;nbsel:=0;nb2:=0;
 
        for i:=1 to 8 do
         for j:=1 to 8 do
           form1.GAME.Cells[i,j]:='vide';
           
         nb:=0;
        if niveau=1 then
        niveau1()
        else if niveau=2 then
          niveau2()
          else niveau3();     


     coloration();
     coloration();

 end;

procedure TForm1.Quitter1Click(Sender: TObject);
var rep:byte;
begin
 rep:=Application.messagebox('ya weldi mthabet t7eb to5rej ??','Quitter Le Jeu ?',mb_yesNoCancel);
if rep=idyes then
application.Terminate;
end;

procedure sound1();
begin
if Form1.sound.Checked=true then
begin
 windows.Beep(2000,100);
end;
end;

procedure TForm1.Reduite1Click(Sender: TObject);
begin
IF Reduite1.Checked=FALSE THEN
  BEGIN
  close.Top:=630;
  sonactiver.Top:=633;
  sondesactiver.Top:=633;

  END;

 reduite1.Checked:=true;
 PleinEcran1.Checked:=false;

 with Form1 do
    begin 
       BorderStyle:=bsSingle; 
      FormStyle   := fsStayOnTop; 
      Left        := 0;
      Top         := 0; 
      Height      := Screen.Height-40; 
      Width       := Screen.Width; 
    end;

end;

procedure TForm1.Active1Click(Sender: TObject);
begin
//open music
gamesound.Enabled:=true;
MediaPlayer3.Open;
MediaPlayer3.Play;
MediaPlayer1.open;
MediaPlayer2.open;
// end open music
Active1.Checked:=true;
Desactiver1.Checked:=false;
sonactiver.Visible:=true;
  sondesactiver.Visible:=false;
end;

procedure TForm1.Desactiver1Click(Sender: TObject);
begin
//close music
gamesound.Enabled:=false;
MediaPlayer3.close;
gamend.Enabled:=false;
MediaPlayer1.close;
MediaPlayer2.close;
// end close music
Desactiver1.Checked:=true;
Active1.Checked:=false;
  sonactiver.Visible:=false;
  sondesactiver.Visible:=true;
end;

procedure TForm1.Facile1Click(Sender: TObject);
var rep:byte;
begin
rep:=Application.messagebox('Passer au NIVEAU Facile ?','Changement de Niveau',mb_yesNoCancel);
if rep=idyes then
begin
scor:=0;
label3.Caption:=inttostr(scor);

label5.Caption:='0/'+inttostr(depmax);
dep:=0;
niveau:=1;
Facile1.Checked:=true;
Moyenne1.Checked:=false;
Difficil1.Checked:=false;
Nouvellepartie1.Click;
end;
end;

procedure TForm1.Moyenne1Click(Sender: TObject);
var rep:byte;
begin

rep:=Application.messagebox('Passer au NIVEAU Difficulté Moyenne ?','Changement de Niveau',mb_yesNoCancel);
if rep=idyes then
begin
niveau:= 2;
scor:=0;
label3.Caption:=inttostr(scor);

label5.Caption:='0/'+inttostr(depmax);
dep:=0;
Facile1.Checked:=false;
Moyenne1.Checked:=true;
Difficil1.Checked:=false;
Nouvellepartie1.Click;
end;
end;

procedure TForm1.Difficil1Click(Sender: TObject);
var rep:byte;
begin
rep:=Application.messagebox('Passer au NIVEAU Difficil ?','Changement de Niveau',mb_yesNoCancel);
if rep=idyes then
begin

label5.Caption:='0/'+inttostr(depmax);
dep:=0;
niveau:=3;
scor:=0;
label3.Caption:=inttostr(scor);
Facile1.Checked:=false;
 Nouvellepartie1.Click;
Moyenne1.Checked:=false;
Difficil1.Checked:=true;
end;
end;

procedure TForm1.PleinEcran1Click(Sender: TObject);
begin
reduite1.Checked:=false;

 IF PleinEcran1.Checked=FALSE THEN
  BEGIN
 close.Top:=630+70;
  sonactiver.Top:=633+70;
  sondesactiver.Top:=633+70;
  END;
   PleinEcran1.Checked:=true;
 with Form1 do  
    begin 
      BorderStyle := bsNone;
      FormStyle   := fsStayOnTop; 
      Left        := 0; 
      Top         := 0; 
      Height      := Screen.Height; 
      Width       := Screen.Width; 
    end;

end;

procedure TForm1.AproposdeDevlopper1Click(Sender: TObject);
begin


form1.Hide;
form2.show;
timer2.Enabled:=false;
end;

procedure TForm1.FormCreate(Sender: TObject);
var
  rStream: TResourceStream;
  fStream: TFileStream;
  fname1,fname2,fname3,fname4: string;
begin

//mange
  {this part extracts the mp3 from exe}
  fname4 := ExtractFileDir(Paramstr(0))+'Mange.mp3';
  rStream := TResourceStream.Create(hInstance, 'mange', RT_RCDATA) ;
  try
   fStream := TFileStream.Create(fname4, fmCreate) ;
   try
    fStream.CopyFrom(rStream, 0) ;
   finally
    fStream.Free;
   end;
  finally
   rStream.Free;
  end;
  {this part plays the mp3}
  MediaPlayer4.Close;
  MediaPlayer4.FileName:=fname4;
  MediaPlayer4.Open;
//end mange

//end game
  {this part extracts the mp3 from exe}
  fname2 := ExtractFileDir(Paramstr(0))+'Endgame.mp3';
  rStream := TResourceStream.Create(hInstance, 'endgame', RT_RCDATA) ;
  try
   fStream := TFileStream.Create(fname2, fmCreate) ;
   try
    fStream.CopyFrom(rStream, 0) ;
   finally
    fStream.Free;
   end;
  finally
   rStream.Free;
  end;
  {this part plays the mp3}
  MediaPlayer1.Close;
  MediaPlayer1.FileName:=fname2;
  MediaPlayer1.Open;
//end game sound

//son jeu
  {this part extracts the mp3 from exe}
  fname1 := ExtractFileDir(Paramstr(0))+'Music.mp3';
  rStream := TResourceStream.Create(hInstance, 'music', RT_RCDATA) ;
  try
   fStream := TFileStream.Create(fname1, fmCreate) ;
   try
    fStream.CopyFrom(rStream, 0) ;
   finally
    fStream.Free;
   end;
  finally
   rStream.Free;
  end;
  {this part plays the mp3}
  MediaPlayer3.Close;
  MediaPlayer3.FileName:=fname1;
  MediaPlayer3.Open;


//  end son de jeu



//eat
  {this part extracts the mp3 from exe}
  fname3 := ExtractFileDir(Paramstr(0))+'Eat.mp3';
  rStream := TResourceStream.Create(hInstance, 'eat', RT_RCDATA) ;
  try
   fStream := TFileStream.Create(fname3, fmCreate) ;
   try
    fStream.CopyFrom(rStream, 0) ;
   finally
    fStream.Free;
   end;
  finally
   rStream.Free;
  end;
  {this part plays the mp3}
  MediaPlayer2.Close;
  MediaPlayer2.FileName:=fname3;
  MediaPlayer2.Open;
//end eat

//timer 3 son de jeu//
     MediaPlayer3.Play;
     gamesound.Interval:=MediaPlayer3.Length div 2;
     gamend.Interval:=MediaPlayer1.Length div 2;
    
depmax:=10;
         reduite1.Checked:=FALSE;
 PleinEcran1.Checked:=false;
Reduite1.Click;
niveau:=1;
nb:=0;
scor:=0;
label3.Caption:=inttostr(scor);
end;


procedure TForm1.Nouvellepartie1Click(Sender: TObject);
begin
panel1.Visible:=true;
panel2.Visible:=true;
panel3.Visible:=true;
scor:=0;
depmax:=10;
dep:=0;
label3.Caption:=inttostr(scor);
 GAME.Visible:=true;
 niveaulabel.Caption:='0';
initialisation();

end;

procedure TForm1.FormResize(Sender: TObject);
begin
 coloration();
end;



procedure TForm1.GAMEMouseDown(Sender: TObject; Button: TMouseButton;
  Shift: TShiftState; X, Y: Integer);
 var col,ligne:integer;
 aux:string;
   begin
   try
     if nbsel>1 then
      begin
        nbsel:=0;
      end;
       try
    game.MouseToCell(x,y,col,ligne);
      except end;
    if (nbsel=0 )and(pos('vide',game.Cells[ligne,col])=0) then
     begin
       selx:=col;
       sely:=ligne;
          if GAME.Cells[ligne,col]='rouge' then GAME.Cells[ligne,col]:='rougeselected'
      else if  GAME.Cells[ligne,col]='vert' then GAME.Cells[ligne,col]:='vertselected'
       else if GAME.Cells[ligne,col]= 'jaune' then GAME.Cells[ligne,col]:='jauneselected'
        else if  GAME.Cells[ligne,col]='mauve' then GAME.Cells[ligne,col]:='mauveselected'
         else if  GAME.Cells[ligne,col]='halwa'then GAME.Cells[ligne,col]:='halwaselected'
          else if  GAME.Cells[ligne,col]='bleu'then GAME.Cells[ligne,col]:='bleuselected';
     nbsel:=1;
      coloration();
      coloration();
      end
     else if nbsel=1 then
     begin
          if (pos('selected',game.Cells[ligne,col])<>0)  then
            begin
            game.Cells[ligne,col]:=copy(game.Cells[ligne,col],1,pos('selected',game.Cells[ligne,col])-1);
             nbsel:=0;
              coloration();
               coloration();
            end
            else
            begin
             if  (((ligne=sely-1)and(col=selx))or((ligne=sely)and(col=selx-1)) or((ligne=sely+1)and(col=selx))or((ligne=sely)and(col=selx+1)))then
             begin
                 if((pos('vide',game.Cells[ligne,col])=0)and(game.Cells[ligne,col]<>copy(game.Cells[sely,selx],1,pos('selected',game.Cells[sely,selx])-1))) then

                begin

                 try
                      game.Cells[sely,selx]:=copy(game.Cells[sely,selx],1,pos('selected',game.Cells[sely,selx])-1);
                      aux:=game.Cells[ligne,col];
                      game.Cells[ligne,col]:=game.Cells[sely,selx] ;
                      game.Cells[sely,selx]:=aux;

                    except  end;

                    recherche();
                    if nb2>=3 then
                     begin
                      nbsel:=0;
                      sound1();
                      inc(dep);
                      label5.Caption:=inttostr(dep)+'/'+inttostr(depmax);
                     end;

                       if nbsel>0 then
                       begin
                            try

                      aux:=game.Cells[ligne,col];
                      game.Cells[ligne,col]:=game.Cells[sely,selx] ;
                      game.Cells[sely,selx]:=aux;
                         game.Cells[sely,selx]:=  game.Cells[sely,selx]+'selected';
                           
                    except  end;
                       end ;




                end;
                end;


            end;

     end;
     Except
     end;

end;

procedure TForm1.Actualiser1Click(Sender: TObject);
begin
coloration();
end;

procedure remplirTete();
var c:integer;
begin
Form1.GAME.Enabled:=false;
for c:=0 to 8 do
   begin

    if form1.game.Cells[0,c]='vide' then
          begin

                 randomize;
                if  Niveau=1 then
                     form1.game.Cells[0,c]:=piece[random(6)+1]
                     else if  Niveau=2 then
                     form1.game.Cells[0,c]:=piece[random(4)+1]
                     else form1.game.Cells[0,c]:=piece[random(6)+1];
          end;

     end;
     if  Niveau=2 then
           BEGIN
                     if Form1.GAME.Cells[1,8]='vide' then
                       BEGIN
                        form1.game.Cells[1,8]:=piece[random(6)+1]
                        end;

                         if form1.game.Cells[1,0]='vide' then
                       BEGIN
                        form1.game.Cells[1,0]:=piece[random(6)+1]
                        end;
           END;

     if  Niveau=3 then
           BEGIN
                     if form1.game.Cells[2,4]='vide' then
                       BEGIN
                        form1.game.Cells[2,4]:=piece[random(6)+1]
                        end;

                        
           END;
           form1.GAME.Enabled:=true;
end;

procedure TForm1.Timer1Timer(Sender: TObject);
var i,j:integer;
axi:string;
verticale,hori:boolean;

begin
verticale:=false;
hori:=false;
if existvide() then
begin
   remplirTete();
game.Enabled:=false;

for i:=1 to nb2-nbv do
begin
       hori:=true;
       for j:=y[i] downto 1 do
       begin
        //remplissage tete//
           remplirTete();
        //end remplissage tete//
           axi:=game.Cells[j,x[i]];
              if axi='vide' then
               begin
           if (game.Cells[j-1,x[i]]<>'vide1')and(game.Cells[j-1,x[i]]<>'vide2')and(game.Cells[j-1,x[i]]<>'vide3')and(game.Cells[j-1,x[i]]<>'vide4')and(game.Cells[j-1,x[i]]<>'vide5')and(game.Cells[j-1,x[i]]<>'vide6') and(game.Cells[j-1,x[i]]<>'vide7')and(game.Cells[j-1,x[i]]<>'vide8')and(game.Cells[j-1,x[i]]<>'vide9')then
           BEGIN
           game.Cells[j,x[i]]:= game.Cells[j-1,x[i]];
           game.Cells[j-1,x[i]]:=axi;
           END
          else begin
            try
             game.Cells[j,x[i]]:= game.Cells[j-2,x[i]];
          game.Cells[j-2,x[i]]:=axi;
          except end;
          end;
              end;

       end;
           //remplissage tete//
           remplirTete();
        //end remplissage tete//
     coloration();
end;
    if (Active1.Checked=true) and (hori=true) then
     begin
     MediaPlayer2.Close;
     MediaPlayer2.Open;
     MediaPlayer2.Play;
     end;
//test
for i:=nb2-nbv+1 to nb2 do
begin
         verticale:=true;
       for j:=y[i] downto 1 do
       begin
        //remplissage tete//
           remplirTete();
        //end remplissage tete//
           axi:=game.Cells[j,x[i]];
              if axi='vide' then
               begin
           if (game.Cells[j-1,x[i]]<>'vide1')and(game.Cells[j-1,x[i]]<>'vide2')and(game.Cells[j-1,x[i]]<>'vide3')and(game.Cells[j-1,x[i]]<>'vide4')and(game.Cells[j-1,x[i]]<>'vide5')and(game.Cells[j-1,x[i]]<>'vide6') and(game.Cells[j-1,x[i]]<>'vide7')and(game.Cells[j-1,x[i]]<>'vide8')and(game.Cells[j-1,x[i]]<>'vide9')then
           BEGIN
           game.Cells[j,x[i]]:= game.Cells[j-1,x[i]];
           game.Cells[j-1,x[i]]:=axi;
           END
          else begin
            try
             game.Cells[j,x[i]]:= game.Cells[j-2,x[i]];
          game.Cells[j-2,x[i]]:=axi;
          except end;
          end;
              end;

       end;
           //remplissage tete//
           remplirTete();
        //end remplissage tete//
     coloration();
     sleep(90)

end;
// end test


         if (Active1.Checked=true) and (verticale=true) then
     begin
     MediaPlayer2.Close;
     MediaPlayer2.Open;
     MediaPlayer2.Play;
     end;

      coloration();
      scor:=nb2*5+scor;
      label3.Caption:=inttostr(scor);
      game.Enabled:=false;
      timer2.Enabled:=false;
      timer1.Interval:=400;
   end
  else
   begin

       timer2.Enabled:=true;
   timer1.Enabled:=false;
   recherche();
   if nb2<3 then
    begin
       game.Enabled:=true;
    end;
  end;


end;

procedure TForm1.closeClick(Sender: TObject);
begin
form1.Quitter1.Click;
end;

procedure TForm1.sonactiverClick(Sender: TObject);
begin
Desactiver1.Click  ;
Active1.Checked:=false;
end;
procedure TForm1.sondesactiverClick(Sender: TObject);
begin
Active1.Click  ;
end;

procedure TForm1.Timer2Timer(Sender: TObject);

begin
inc(ss);
mm:=50-ss+(depmax div 2)+4;
label6.Caption:=inttostr(mm)+' ';

if (niveau=1)and(mm<=0)and(dep>=depmax)then
begin
if Active1.Checked=true then
begin

 gamend.Enabled:=true;
 gamesound.Enabled:=false;
 MediaPlayer3.Stop;
 MediaPlayer1.Open;
 MediaPlayer1.Play;
end;
timer2.Enabled:=true;
lose.visible:=true;
game.Visible:=false;
form1.Refresh;
timer2.Enabled:=false;
form1.Refresh;
    showmessage('EL Marra ejjaya hihihi loOl <5sert>');
 shellexecute(0,'open',pchar(application.ExeName),nil,nil,sw_show);
 application.Terminate;
enD


else if (niveau=2)and(mm<=0)and(dep>=depmax)then
begin
if Active1.Checked=true then
begin
 gamend.Enabled:=true;
 gamesound.Enabled:=false;
 MediaPlayer3.Stop;
 MediaPlayer1.Open;
 MediaPlayer1.Play;
end;
game.Visible:=false;
lose.visible:=true;
form1.Refresh;
timer2.Enabled:=false;
sleep(2000);
form1.Refresh;
    showmessage('EL Marra ejjaya hihihi loOl <5sert>');
 shellexecute(0,'open',pchar(application.ExeName),nil,nil,sw_show);
 application.Terminate;
end

else if (niveau=3)and(mm<=0)and(dep>=depmax)then
begin
if Active1.Checked=true then
begin

 gamend.Enabled:=true;
 gamesound.Enabled:=false;
 MediaPlayer3.Stop;
 MediaPlayer1.Open;
 MediaPlayer1.Play;
end;
game.Visible:=false;
lose.visible:=true;
form1.Refresh;
sleep(2000);
timer2.Enabled:=false;
form1.Refresh;
    showmessage('EL Marra ejjaya hihihi loOl <5sert>');
 shellexecute(0,'open',pchar(application.ExeName),nil,nil,sw_show);
 application.Terminate;
end
else if ((niveau=1)and(dep>=depmax))then
begin
gagne.visible:=true;
game.Visible:=false;
form1.Refresh;
timer2.Enabled:=false;
sleep(3000);
 game.Visible:=true;
 gagne.Visible:=false;
niveau:=2;
initialisation();

end
else if ((niveau=2)and(dep>=depmax))then
begin
gagne.visible:=true;
game.Visible:=false;
timer2.Enabled:=false;
form1.Refresh;
sleep(3000);
 game.Visible:=true;
 gagne.Visible:=false;
niveau:=3;
initialisation();
end
else if ((niveau=3)and(dep>=depmax))then
begin
gagne.visible:=true;
game.Visible:=false;
timer2.Enabled:=false;
form1.Refresh;
sleep(3000);
 game.Visible:=true;
 gagne.Visible:=false;
niveau:=1;
inc(depmax,3);
initialisation();
end;

end;

procedure TForm1.Commentjouer1Click(Sender: TObject);
begin
form1.Hide;
form3.show;
timer2.Enabled:=false;
end;


procedure TForm1.gamesoundTimer(Sender: TObject);
begin
MediaPlayer3.Close;
MediaPlayer3.open;
MediaPlayer3.Play;
end;

procedure TForm1.gamendTimer(Sender: TObject);
begin
MediaPlayer1.Close;
MediaPlayer1.open;
MediaPlayer1.Play;
end;

end.
